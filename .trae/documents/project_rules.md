# AI Agent 项目操作规则

## 1. 文档管理约束（仅适用于文档，不适用于代码）

### 1.1 文档存储位置规则

- **MUST**: 所有AI Agent生成的文档必须存储在指定目录
- **MUST**: 产品文档存储在 `.trae/documents/`
- **MUST**: 技术文档存储在 `docs/`
- **MUST**: 临时文档存储在 `.trae/temp/`
- **FORBIDDEN**: 在项目根目录直接创建文档文件

### 1.2 文档命名规则

- **MUST**: 文档名称必须使用kebab-case格式，如 `product-requirements.md`
- **MUST**: 版本文档使用格式：`文档名_v1.0.md`, `文档名_v1.1.md`
- **MUST**: 备份文档使用格式：`文档名_backup_YYYYMMDD.md`
- **FORBIDDEN**: 使用中文或特殊字符作为文件名

### 1.3 文档版本管理（仅适用于文档）

- **MUST**: 文档必须使用版本命名管理（v1.0, v1.1, v2.0等）

- **MUST**: 修改现有文档前，必须创建版本备份

- **MUST**: 在文档头部添加版本元数据：
  
  ```markdown
  
  ```

---

version: "v1.2"
created: "2025-10-28"
modified: "2025-10-28"
author: "AI Agent"
type: "product-document"

---

```
### 1.4 时间使用约束规则
- **MUST**: AI Agent在以下场景必须使用MCP time组件获取时间：
  - 生成文件名时需要时间戳（如备份文件：`文档名_backup_YYYYMMDD.md`）
  - 文档内容中需要添加时间信息（如版本元数据的created、modified字段）
  - 代码备注中需要时间标记（如文件头注释的创建时间）
  - 版本备份文件命名
  - 操作日志记录的时间戳
- **FORBIDDEN**: 使用系统时间或自行生成时间
- **MUST**: 时间格式统一使用ISO 8601标准：`YYYY-MM-DD` 或 `YYYY-MM-DDTHH:mm:ss`
- **MUST**: 确保所有时间信息的一致性和准确性

### 1.5 文档创建前检查规则
- **MUST**: 创建文档前必须检查目标路径是否已存在同名文件
- **MUST**: 如果文档已存在，必须询问用户是否创建新版本或更新现有版本
- **MUST**: 更新现有文档时，必须先创建备份版本
- **FORBIDDEN**: 直接覆盖现有文档，除非用户明确确认

### 1.6 目录结构维护
```

项目根目录/
├── .trae/
│   ├── documents/          # 核心产品文档
│   │   ├── product-requirements_v1.0.md
│   │   ├── technical-architecture_v1.0.md
│   │   └── backups/       # 文档备份目录
│   └── temp/              # 临时文档
├── docs/                  # 技术文档
│   ├── api/              # API文档
│   ├── deployment/       # 部署文档
│   └── user-guide/       # 用户指南
├── src/                  # 源代码（使用Git版本控制）
└── config/               # 配置文件

```

## 2. 代码生成约束（使用Git版本控制，不使用版本命名）

### 2.1 代码文件命名规范

- **Java文件**: 使用PascalCase，如 `HistoryAnalysisService.java`
- **Python文件**: 使用snake_case，如 `text_analyzer.py`
- **TypeScript文件**: 使用PascalCase（组件）或camelCase（工具），如 `WordCloudComponent.tsx`
- **配置文件**: 使用kebab-case，如 `application-dev.yml`

### 2.2 代码文件创建规则

- **MUST**: 代码文件使用Git进行版本控制，不使用文件名版本管理
- **MUST**: 每个生成的代码文件必须包含文件头注释
- **MUST**: 包含创建时间、功能描述、依赖关系
- **MUST**: 遵循单一职责原则，一个文件只负责一个主要功能
- **FORBIDDEN**: 对代码文件使用版本后缀命名（如_v1.0.java）

### 2.3 代码依赖管理

- **MUST**: 在生成代码前检查依赖是否已在项目中声明
- **MUST**: 如需新依赖，先更新相应的依赖文件（pom.xml, requirements.txt, package.json）
- **FORBIDDEN**: 使用未声明的外部依赖

## 3. 自动化任务执行规范

### 3.1 任务执行边界

- **ALLOWED**: 创建新文件和目录
- **ALLOWED**: 修改配置文件（需备份）
- **ALLOWED**: 生成代码框架和模板
- **FORBIDDEN**: 删除现有文件
- **FORBIDDEN**: 修改 `.git/` 目录内容
- **FORBIDDEN**: 执行系统级命令

### 3.2 错误处理机制

- **MUST**: 在执行任何文件操作前进行可行性检查
- **MUST**: 操作失败时记录详细错误信息
- **MUST**: 提供回滚机制建议

## 4. 项目完整性保护

### 4.1 关键文件保护

以下文件类型需要特殊保护：

- 产品需求文档 (PRD)
- 技术架构文档
- 数据库设计文档
- API接口文档
- 配置文件

### 4.2 修改确认机制

- **MUST**: 修改关键文件前，明确说明修改原因和影响范围
- **MUST**: 提供修改前后的对比信息
- **MUST**: 征得用户确认后再执行修改

## 5. 质量控制标准

### 5.1 代码质量检查

- **MUST**: 生成的代码必须符合对应语言的编码规范
- **MUST**: 包含必要的错误处理和输入验证
- **MUST**: 提供基本的单元测试模板

### 5.2 文档质量标准

- **MUST**: 使用标准Markdown格式
- **MUST**: 包含目录结构（TOC）
- **MUST**: 代码示例必须可执行
- **MUST**: 链接和引用必须有效

## 6. 协作和通信规范

### 6.1 操作日志记录

- **MUST**: 记录所有文件创建、修改、删除操作
- **MUST**: 包含操作时间、文件路径、操作类型
- **MUST**: 日志文件位置：`.trae/logs/agent_operations.log`

### 6.2 用户交互原则

- **MUST**: 重要操作前主动询问用户确认
- **MUST**: 提供清晰的操作说明和预期结果
- **MUST**: 操作完成后提供结果摘要

## 7. 应急处理机制

### 7.1 冲突解决

- 如果检测到文件冲突，停止操作并报告
- 提供多种解决方案供用户选择
- 不得自动解决可能影响项目完整性的冲突

### 7.2 回滚机制

- 保持最近3次操作的备份
- 提供一键回滚功能
- 回滚前确认不会影响其他组件

## 8. 性能和资源约束

### 8.1 资源使用限制

- 单次操作创建的文件数量不超过50个
- 单个文件大小不超过10MB
- 避免创建深度超过5层的目录结构

### 8.2 执行效率要求

- 文件操作响应时间不超过30秒
- 大批量操作需要显示进度信息
- 提供操作取消机制

## 9. 第三方工具和依赖安装规范

### 9.1 工具安装位置约束

- **MUST**: AI Agent在项目开发过程中安装的所有第三方工具、工具包、开发环境必须安装到D盘或H盘
- **FORBIDDEN**: 不允许将任何第三方工具、工具包安装到C盘
- **MUST**: 推荐的安装路径：
  - 开发工具：`H:\开发环境\{工具名称}`
  - 项目依赖：`H:\开发环境\dependencies\{项目名称}`
  - 临时工具：`D:\temp\tools\{工具名称}`

### 9.2 工具类型约束

包括但不限于以下工具类型：

- **Node.js及相关包管理器** (npm, yarn, pnpm)
- **Python及相关包** (pip安装的包)
- **Java开发工具** (Maven, Gradle依赖)
- **数据库工具** (MySQL, Redis客户端)
- **测试工具** (Puppeteer, Selenium等)
- **构建工具** (Webpack, Vite等)
- **代码分析工具** (ESLint, SonarQube等)

### 9.3 安装前检查规则

- **MUST**: 安装任何工具前，必须检查目标安装路径
- **MUST**: 如果检测到安装路径指向C盘，必须重新指定到D盘或H盘
- **MUST**: 安装完成后记录工具安装位置和版本信息
- **MUST**: 在项目文档中维护已安装工具的清单

### 9.4 环境变量配置

- **MUST**: 安装工具后正确配置环境变量指向D盘或H盘路径
- **MUST**: 确保PATH环境变量不包含C盘的工具路径
- **MUST**: 项目配置文件中的工具路径必须指向正确的安装位置

### 9.5 违规处理机制

- **MUST**: 检测到C盘安装路径时，立即停止安装操作
- **MUST**: 提示用户重新选择D盘或H盘路径
- **MUST**: 记录违规尝试并在操作日志中标记
- **MUST**: 提供自动迁移工具路径的建议

### 9.6 智能镜像使用策略

- **MUST**: 当遇到任何官方网站无法访问或下载速度过慢的情况时，AI Agent必须自动启动镜像搜索机制

- **MUST**: 建立通用的镜像搜索和验证流程：

  1. 首先尝试官方源

  2. 如果失败，自动搜索中国主流镜像网站

  3. 验证镜像源的可用性和完整性

  4. 选择最优的镜像源进行下载

- **MUST**: AI Agent必须具备自主学习和发现新镜像源的能力

- **MUST**: 建立镜像源优先级评估机制：

  - 网络连接速度

  - 数据完整性

  - 更新频率

  - 可靠性历史记录

#### 通用镜像发现策略

**搜索策略**：

- 使用web搜索查找 "{工具名} 中国镜像" 或 "{工具名} mirror china"

- 检查知名镜像提供商：清华大学、阿里云、腾讯云、华为云、网易等

- 验证镜像源的官方认证状态

**验证机制**：

- 检查镜像源的SSL证书

- 验证文件哈希值（如果可用）

- 测试下载速度和稳定性

- 检查镜像同步时间

**自动切换逻辑**：

- 设置超时阈值（如30秒无响应）

- 设置速度阈值（如低于100KB/s）

- 建立失败重试机制

- 记录成功的镜像源供后续使用

#### 镜像使用记录和学习

- **MUST**: 维护一个动态的镜像源数据库，记录：

  - 工具/包名称

  - 成功使用的镜像源

  - 使用时间和成功率

  - 下载速度统计

- **MUST**: 基于历史数据优化镜像选择策略

- **MUST**: 定期验证已记录镜像源的可用性

- **MUST**: 在项目文档中记录实际使用的镜像源

### 9.7 AI Agent镜像使用执行机制

#### 自动镜像发现流程

- **MUST**: AI Agent在遇到下载失败时，必须按以下步骤执行：

  1. **初始尝试**: 使用官方源进行下载，设置30秒超时

  2. **失败检测**: 检测到超时、连接失败或速度过慢时触发镜像搜索

  3. **智能搜索**: 使用web_search工具搜索相关镜像源

  4. **镜像验证**: 对找到的镜像源进行可用性测试

  5. **最优选择**: 根据速度和可靠性选择最佳镜像源

  6. **执行下载**: 使用选定的镜像源完成下载

  7. **记录学习**: 将成功的镜像源记录到项目文档中

#### 镜像搜索关键词策略

- **MUST**: 使用以下搜索模式查找镜像源：

  - "{工具名称} 中国镜像"

  - "{工具名称} mirror china"

  - "{工具名称} 清华镜像"

  - "{工具名称} 阿里云镜像"

  - "{包管理器名称} 镜像源配置"

#### 镜像验证标准

- **MUST**: 对发现的镜像源进行以下验证：

  - **连通性测试**: 检查URL是否可访问

  - **速度测试**: 测试下载速度是否满足阈值要求

  - **完整性验证**: 如果可能，验证文件哈希值

  - **SSL安全性**: 检查HTTPS证书有效性

  - **同步时间**: 检查镜像更新时间是否及时

#### 动态学习和优化

- **MUST**: AI Agent必须具备以下学习能力：

  - **成功记录**: 记录每次成功使用的镜像源和性能数据

  - **失败分析**: 分析失败原因并避免重复尝试无效镜像

  - **性能优化**: 基于历史数据优先选择高性能镜像源

  - **自动更新**: 定期重新验证已记录镜像源的可用性

#### 特殊情况处理

- **MUST**: 处理以下特殊情况：

  - **全部镜像失败**: 提示用户手动干预或稍后重试

  - **网络环境变化**: 重新评估镜像源优先级

  - **新工具首次安装**: 主动搜索并建立镜像源记录

  - **镜像源失效**: 自动移除失效镜像并寻找替代方案

## 10. 环境配置管理规范

### 10.1 环境配置文档管理

- **MUST**: 所有环境配置信息必须统一记录在 `environment-credentials-config.md` 文档中
- **MUST**: 包含但不限于：数据库用户名密码、服务端口、API密钥、文件路径等
- **MUST**: 配置信息发生变更时，必须同步更新配置文档
- **MUST**: 新增环境或服务时，必须在配置文档中添加相应记录

### 10.2 配置使用规范

- **MUST**: 遇到用户名、密码、端口等配置错误时，必须首先查阅 `environment-credentials-config.md` 文档
- **FORBIDDEN**: 不得在未查阅配置文档的情况下，随意创建新用户或修改密码
- **FORBIDDEN**: 不得重复配置已存在的环境或服务
- **MUST**: 使用配置文档中记录的准确信息进行连接和配置

### 10.3 配置验证流程

- **MUST**: 在进行任何数据库连接、服务启动前，必须验证配置文档中的信息
- **MUST**: 配置失败时，按以下顺序排查：
  1. 检查配置文档中的用户名、密码、端口是否正确
  2. 验证服务是否正常运行
  3. 检查网络连接和防火墙设置
  4. 确认权限配置是否正确
- **MUST**: 排查完成后，如需修改配置，必须同步更新配置文档

### 10.4 敏感信息管理

- **MUST**: 配置文档中的敏感信息（密码、密钥等）必须妥善保管
- **MUST**: 定期检查和更新密码，确保安全性
- **MUST**: 在版本控制中适当保护敏感配置信息
- **MUST**: 团队成员变更时，及时更新相关密码和权限

## 11. 监控和维护

### 11.1 应用监控

- **MUST**: 关键业务指标监控
- **MUST**: 系统性能监控
- **MUST**: 错误率和响应时间监控

### 11.2 代码维护

- **MUST**: 定期代码审查
- **MUST**: 及时更新依赖版本
- **MUST**: 清理无用代码和注释